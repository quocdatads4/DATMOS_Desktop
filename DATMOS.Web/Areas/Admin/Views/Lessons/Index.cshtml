@{
    ViewData["Title"] = "Quản lý bài học";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";

    // Dữ liệu mẫu từ controller
    var sampleLessons = ViewData.Model as IEnumerable<dynamic> ?? new List<dynamic>();

    // Tính toán thống kê từ dữ liệu mẫu
    var totalLessons = sampleLessons.Count();
    var activeLessons = sampleLessons.Count(l => l.Status == "Active");
    var hiddenLessons = sampleLessons.Count(l => l.Status == "Hidden");
    var pendingLessons = sampleLessons.Count(l => l.Status == "Pending");
}

@section VendorStyles {
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" />
    
    <!-- Select2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    
    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
}

@section PageStyles {
    <link rel="stylesheet" href="~/areas/admin/css/admin-data-table.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/areas/admin/css/admin-lessons.css" asp-append-version="true" />
}

<!-- Statistics Cards - Compact Design -->
<div class="admin-lessons-stats-compact">
    <div class="stats-grid">
        <div class="stat-item stat-total">
            <div class="stat-icon">
                <i class="icon-base ti ti-video"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">@totalLessons</h3>
                <p class="stat-label">Tổng bài học</p>
            </div>
        </div>
        <div class="stat-item stat-active">
            <div class="stat-icon">
                <i class="icon-base ti ti-player-play"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">@activeLessons</h3>
                <p class="stat-label">Đang hiển thị</p>
            </div>
        </div>
        <div class="stat-item stat-inactive">
            <div class="stat-icon">
                <i class="icon-base ti ti-eye-off"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">@hiddenLessons</h3>
                <p class="stat-label">Đã ẩn</p>
            </div>
        </div>
        <div class="stat-item stat-pending">
            <div class="stat-icon">
                <i class="icon-base ti ti-clock"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-value">@pendingLessons</h3>
                <p class="stat-label">Chờ duyệt</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Filters -->
<div class="d-flex gap-2 mb-3">
    <a href="#" class="btn btn-outline-primary quick-filter active waves-effect" data-filter="all">
        <i class="icon-base ti ti-video me-1"></i>
        Tất cả
    </a>
    <a href="#" class="btn btn-outline-success quick-filter waves-effect" data-filter="active">
        <i class="icon-base ti ti-player-play me-1"></i>
        Đang hiển thị
    </a>
    <a href="#" class="btn btn-outline-danger quick-filter waves-effect" data-filter="hidden">
        <i class="icon-base ti ti-eye-off me-1"></i>
        Đã ẩn
    </a>
    <a href="#" class="btn btn-outline-warning quick-filter waves-effect" data-filter="pending">
        <i class="icon-base ti ti-clock me-1"></i>
        Chờ duyệt
    </a>
    
    <!-- Course Filter -->
    <div class="ms-auto">
        <select class="form-select form-select-sm w-auto course-filter">
            <option value="">Tất cả khóa học</option>
            <option value="CRS001">MOS Word 2019</option>
            <option value="CRS002">MOS Excel 2019</option>
            <option value="CRS003">MOS PowerPoint 2019</option>
            <option value="CRS004">MOS Word 2019 Expert</option>
            <option value="CRS005">MOS Excel 2019 Expert</option>
        </select>
    </div>
    
    <div class="view-toggle">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-secondary active waves-effect" data-view="list">
                <i class="icon-base ti ti-list"></i>
            </button>
            <button type="button" class="btn btn-outline-secondary waves-effect" data-view="grid">
                <i class="icon-base ti ti-grid-dots"></i>
            </button>
        </div>
    </div>
</div>

<!-- Bulk Actions -->
<div class="bulk-actions">
    <div class="bulk-selection-count">0 bài học được chọn</div>
    <div class="bulk-actions-buttons">
        <button class="btn btn-success btn-sm bulk-activate">
            <i class="icon-base ti ti-player-play me-1"></i>
            Hiển thị
        </button>
        <button class="btn btn-danger btn-sm bulk-hide">
            <i class="icon-base ti ti-eye-off me-1"></i>
            Ẩn
        </button>
        <button class="btn btn-outline-danger btn-sm bulk-delete">
            <i class="icon-base ti ti-trash me-1"></i>
            Xóa
        </button>
        <button class="btn btn-outline-primary btn-sm bulk-export">
            <i class="icon-base ti ti-download me-1"></i>
            Xuất CSV
        </button>
    </div>
</div>

<!-- Main Card -->
<div class="card">
    <div class="card-header border-bottom">
        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <div class="bg-primary bg-opacity-10 p-2 rounded me-3">
                    <i class="icon-base ti ti-video text-primary" style="font-size: 1.5rem;"></i>
                </div>
                <div>
                    <h5 class="card-title mb-0 d-flex align-items-center">
                        <span class="me-2">DANH SÁCH BÀI HỌC</span>
                        <span class="badge bg-primary">MOS</span>
                    </h5>
                    <p class="text-muted mb-0">
                        <i class="icon-base ti ti-database me-1"></i>
                        Quản lý tất cả bài học trong hệ thống khóa học Microsoft Office Specialist
                    </p>
                </div>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-primary btn-create-lesson">
                    <i class="icon-base ti ti-video-plus me-2"></i>
                    Thêm bài học mới
                </button>
            </div>
        </div>
    </div>

    <!-- Desktop Table View -->
    <div class="card-datatable admin-lessons-table">
        <table class="datatables-lessons table border-top">
            <thead>
                <tr>
                    <th width="40">
                        <div class="form-check">
                            <input class="form-check-input select-all-lessons" type="checkbox" />
                        </div>
                    </th>
                    <th>Thông tin bài học</th>
                    <th>Khóa học</th>
                    <th>Thời lượng</th>
                    <th>Loại</th>
                    <th>Thứ tự</th>
                    <th>Trạng thái</th>
                    <th width="120">Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var lesson in sampleLessons)
                {
                    <tr>
                        <td>
                            <div class="form-check">
                                <input class="form-check-input lesson-checkbox" type="checkbox" value="@lesson.Id" />
                            </div>
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="lesson-avatar @(lesson.IsActive ? "lesson-avatar-active" : "lesson-avatar-inactive") lesson-avatar-initials me-3">
                                    @if (!string.IsNullOrEmpty(lesson.ThumbnailUrl))
                                    {
                                        <img src="@lesson.ThumbnailUrl" alt="@lesson.Title" />
                                    }
                                    else
                                    {
                                        <span>@(!string.IsNullOrEmpty(lesson.Title) ? lesson.Title.Substring(0, 1).ToUpper() : "?")</span>
                                    }
                                </div>
                                <div class="d-flex flex-column">
                                    <span class="fw-semibold bg-primary bg-opacity-10 text-primary px-2 py-1 rounded mb-1 d-inline-block">@lesson.Title</span>
                                    <div class="d-flex gap-1 mt-1">
                                        <small class="text-muted bg-success bg-opacity-10 px-2 py-1 rounded d-inline-block">
                                            <i class="icon-base ti ti-badge me-1"></i>@lesson.Type
                                        </small>
                                        @if (lesson.IsFree)
                                        {
                                            <small class="text-muted bg-info bg-opacity-10 px-2 py-1 rounded d-inline-block">
                                                <i class="icon-base ti ti-gift me-1"></i>Miễn phí
                                            </small>
                                        }
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-semibold">@lesson.CourseName</span>
                                <small class="text-muted">@lesson.CourseCode</small>
                            </div>
                        </td>
                        <td>
                            <span>@lesson.Duration phút</span>
                        </td>
                        <td>
                            <span class="badge bg-label-@(lesson.Type == "Video" ? "info" : lesson.Type == "Bài đọc" ? "success" : "warning")">@lesson.Type</span>
                        </td>
                        <td>
                            <span class="badge bg-label-secondary">@lesson.Order</span>
                        </td>
                        <td>
                            @if (lesson.IsActive && lesson.Status == "Active")
                            {
                                <span class="status-badge status-badge-active">
                                    <i class="icon-base ti ti-circle-check"></i>
                                    Đang hiển thị
                                </span>
                            }
                            else if (lesson.Status == "Hidden")
                            {
                                <span class="status-badge status-badge-inactive">
                                    <i class="icon-base ti ti-eye-off"></i>
                                    Đã ẩn
                                </span>
                            }
                            else
                            {
                                <span class="status-badge status-badge-pending">
                                    <i class="icon-base ti ti-clock"></i>
                                    @lesson.Status
                                </span>
                            }
                        </td>
                        <td class="no-sort">
                            <div class="action-buttons">
                                <!-- Nút Bật/Tắt -->
                                <form method="post" class="d-inline toggle-lesson-form"
                                      data-lesson-id="@lesson.Id"
                                      data-lesson-title="@lesson.Title"
                                      data-lesson-active="@lesson.IsActive">
                                    <input type="hidden" name="id" value="@lesson.Id" />
                                    <button type="button" 
                                            class="btn btn-icon btn-text-@(lesson.IsActive ? "success" : "secondary") waves-effect waves-light rounded-pill toggle-record" 
                                            title="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị")"
                                            aria-label="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị") @lesson.Title"
                                            data-bs-toggle="tooltip"
                                            data-bs-original-title="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị")">
                                        <i class="icon-base ti @(lesson.IsActive ? "ti-toggle-right" : "ti-toggle-left")"></i>
                                    </button>
                                </form>
                                
                                <!-- Nút Chỉnh sửa -->
                                <a href="#" 
                                   class="btn btn-icon btn-text-warning waves-effect waves-light rounded-pill edit-record"
                                   title="Chỉnh sửa"
                                   aria-label="Chỉnh sửa bài học @lesson.Title"
                                   data-bs-toggle="tooltip"
                                   data-bs-original-title="Chỉnh sửa">
                                    <i class="icon-base ti ti-edit"></i>
                                </a>
                                
                                <!-- Nút Xem trước -->
                                <a href="#" 
                                   class="btn btn-icon btn-text-info waves-effect waves-light rounded-pill preview-record"
                                   title="Xem trước"
                                   aria-label="Xem trước bài học @lesson.Title"
                                   data-bs-toggle="tooltip"
                                   data-bs-original-title="Xem trước">
                                    <i class="icon-base ti ti-player-play"></i>
                                </a>
                                
                                <!-- Nút Xóa -->
                                <form method="post" class="d-inline delete-lesson-form"
                                      data-lesson-id="@lesson.Id"
                                      data-lesson-title="@lesson.Title">
                                    <input type="hidden" name="id" value="@lesson.Id" />
                                    <button type="button" 
                                            class="btn btn-icon btn-text-secondary waves-effect waves-light rounded-pill delete-record" 
                                            title="Xóa"
                                            aria-label="Xóa bài học @lesson.Title"
                                            data-bs-toggle="tooltip"
                                            data-bs-original-title="Xóa"
                                            @(!lesson.IsActive ? "disabled" : "")>
                                        <i class="icon-base ti ti-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Mobile Grid View -->
    <div class="mobile-lessons-grid p-4">
        @foreach (var lesson in sampleLessons)
        {
            <div class="lesson-card">
                <div class="lesson-card-header">
                    <div class="lesson-avatar @(lesson.IsActive ? "lesson-avatar-active" : "lesson-avatar-inactive") lesson-avatar-initials">
                        @if (!string.IsNullOrEmpty(lesson.ThumbnailUrl))
                        {
                            <img src="@lesson.ThumbnailUrl" alt="@lesson.Title" />
                        }
                        else
                        {
                            <span>@(!string.IsNullOrEmpty(lesson.Title) ? lesson.Title.Substring(0, 1).ToUpper() : "?")</span>
                        }
                    </div>
                    <div class="lesson-card-info">
                        <h6 class="mb-1">@lesson.Title</h6>
                        <small class="text-muted">@lesson.CourseName</small>
                    </div>
                    <div class="lesson-card-actions">
                        <!-- Nút Bật/Tắt cho mobile -->
                        <form method="post" class="d-inline toggle-lesson-form"
                              data-lesson-id="@lesson.Id"
                              data-lesson-title="@lesson.Title"
                              data-lesson-active="@lesson.IsActive">
                            <input type="hidden" name="id" value="@lesson.Id" />
                            <button type="button" 
                                    class="btn btn-icon btn-text-@(lesson.IsActive ? "success" : "secondary") waves-effect waves-light rounded-pill toggle-record" 
                                    title="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị")"
                                    aria-label="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị") @lesson.Title"
                                    data-bs-toggle="tooltip"
                                    data-bs-original-title="@(lesson.IsActive ? "Ẩn bài học" : "Hiển thị")">
                                <i class="icon-base ti @(lesson.IsActive ? "ti-toggle-right" : "ti-toggle-left")"></i>
                            </button>
                        </form>
                        
                        <!-- Nút Chỉnh sửa cho mobile -->
                        <a href="#" 
                           class="btn btn-icon btn-text-warning waves-effect waves-light rounded-pill edit-record"
                           title="Chỉnh sửa"
                           aria-label="Chỉnh sửa bài học @lesson.Title"
                           data-bs-toggle="tooltip"
                           data-bs-original-title="Chỉnh sửa">
                            <i class="icon-base ti ti-edit"></i>
                        </a>
                    </div>
                </div>
                <div class="lesson-card-details">
                    <div class="lesson-card-detail">
                        <span class="lesson-card-label">Loại</span>
                        <span class="lesson-card-value">
                            <span class="badge bg-label-@(lesson.Type == "Video" ? "info" : lesson.Type == "Bài đọc" ? "success" : "warning")">@lesson.Type</span>
                        </span>
                    </div>
                    <div class="lesson-card-detail">
                        <span class="lesson-card-label">Thời lượng</span>
                        <span class="lesson-card-value">@lesson.Duration phút</span>
                    </div>
                    <div class="lesson-card-detail">
                        <span class="lesson-card-label">Thứ tự</span>
                        <span class="lesson-card-value badge bg-label-secondary">@lesson.Order</span>
                    </div>
                    <div class="lesson-card-detail">
                        <span class="lesson-card-label">Trạng thái</span>
                        <span class="lesson-card-value">
                            @if (lesson.IsActive && lesson.Status == "Active")
                            {
                                <span class="status-badge status-badge-active">Đang hiển thị</span>
                            }
                            else if (lesson.Status == "Hidden")
                            {
                                <span class="status-badge status-badge-inactive">Đã ẩn</span>
                            }
                            else
                            {
                                <span class="status-badge status-badge-pending">@lesson.Status</span>
                            }
                        </span>
                    </div>
                </div>
                <div class="mt-3">
                    <form method="post" class="d-inline delete-lesson-form"
                          data-lesson-id="@lesson.Id"
                          data-lesson-title="@lesson.Title">
                        <input type="hidden" name="id" value="@lesson.Id" />
                        <button type="button" 
                                class="btn btn-icon btn-text-secondary waves-effect waves-light rounded-pill delete-record w-100"
                                title="Xóa"
                                aria-label="Xóa bài học @lesson.Title"
                                data-bs-toggle="tooltip"
                                data-bs-original-title="Xóa"
                                @(!lesson.IsActive ? "disabled" : "")>
                            <i class="icon-base ti ti-trash me-1"></i>
                            Xóa
                        </button>
                    </form>
                </div>
            </div>
        }
    </div>
</div>

<!-- Include Create/Edit modal -->
<div id="lessonModalContainer"></div>

@section VendorScripts {
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <!-- Select2 -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Toastr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
}

@section PageScripts {
    <script src="~/areas/admin/js/admin-lessons.js" asp-append-version="true"></script>
}

@section Scripts {
    <script>
        // Initialize tooltips
        $(function () {
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
        
        // Handle toggle lesson with SweetAlert2
        $(document).ready(function() {
            $('.toggle-record').on('click', function(e) {
                e.preventDefault();
                
                const form = $(this).closest('.toggle-lesson-form');
                const lessonId = form.data('lesson-id');
                const lessonTitle = form.data('lesson-title') || 'bài học này';
                const isActive = form.data('lesson-active') === 'True' || form.data('lesson-active') === true;
                
                const action = isActive ? 'ẩn' : 'hiển thị';
                const actionText = isActive ? 'Ẩn' : 'Hiển thị';
                const icon = isActive ? 'warning' : 'info';
                const confirmButtonColor = isActive ? '#ffab00' : '#71dd37';
                
                Swal.fire({
                    title: `Xác nhận ${action} bài học`,
                    html: `Bạn có chắc chắn muốn ${action} <strong>${lessonTitle}</strong>?<br><br>
                           <small class="text-muted">${isActive ? 'Bài học sẽ không còn hiển thị cho học viên.' : 'Bài học sẽ được hiển thị cho học viên.'}</small>`,
                    icon: icon,
                    showCancelButton: true,
                    confirmButtonText: actionText,
                    cancelButtonText: 'Hủy',
                    confirmButtonColor: confirmButtonColor,
                    cancelButtonColor: '#3085d6',
                    reverseButtons: true,
                    customClass: {
                        confirmButton: `btn ${isActive ? 'btn-warning' : 'btn-success'}`,
                        cancelButton: 'btn btn-secondary'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading state
                        const toggleBtn = form.find('.toggle-record');
                        const originalHtml = toggleBtn.html();
                        toggleBtn.prop('disabled', true).html('<i class="ti ti-loader-2 spinner"></i>');
                        
                        // Submit the form
                        form.submit();
                    }
                });
            });
            
            // Handle delete lesson with SweetAlert2
            $('.delete-record').on('click', function(e) {
                e.preventDefault();
                
                const form = $(this).closest('.delete-lesson-form');
                const lessonId = form.data('lesson-id');
                const lessonTitle = form.data('lesson-title') || 'bài học này';
                const isDisabled = $(this).prop('disabled');
                
                if (isDisabled) {
                    return;
                }
                
                Swal.fire({
                    title: 'Xác nhận xóa bài học',
                    html: `Bạn có chắc chắn muốn xóa <strong>${lessonTitle}</strong>?<br><br>
                           <small class="text-muted">Hành động này không thể hoàn tác. Tất cả dữ liệu liên quan sẽ bị xóa.</small>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Xóa',
                    cancelButtonText: 'Hủy',
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    reverseButtons: true,
                    customClass: {
                        confirmButton: 'btn btn-danger',
                        cancelButton: 'btn btn-secondary'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading state
                        const deleteBtn = form.find('.delete-record');
                        const originalHtml = deleteBtn.html();
                        deleteBtn.prop('disabled', true).html('<i class="ti ti-loader-2 spinner"></i>');
                        
                        // Submit the form
                        form.submit();
                    }
                });
            });
            
            // Handle form submission to prevent double submission
            $('.toggle-lesson-form').on('submit', function(e) {
                const submitBtn = $(this).find('.toggle-record');
                if (submitBtn.prop('disabled')) {
                    e.preventDefault();
                    return false;
                }
                submitBtn.prop('disabled', true).html('<i class="ti ti-loader-2 spinner"></i>');
                return true;
            });
            
            $('.delete-lesson-form').on('submit', function(e) {
                const submitBtn = $(this).find('.delete-record');
                if (submitBtn.prop('disabled')) {
                    e.preventDefault();
                    return false;
                }
                submitBtn.prop('disabled', true).html('<i class="ti ti-loader-2 spinner"></i>');
                return true;
            });

            // Handle quick filters
            $('.quick-filter').on('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all filters
                $('.quick-filter').removeClass('active');
                // Add active class to clicked filter
                $(this).addClass('active');
                
                const filter = $(this).data('filter');
                
                // Show/hide rows based on filter
                $('tbody tr').each(function() {
                    const $row = $(this);
                    const status = $row.find('.status-badge').text().trim().toLowerCase();
                    
                    let showRow = false;
                    
                    switch(filter) {
                        case 'all':
                            showRow = true;
                            break;
                        case 'active':
                            showRow = status.includes('đang hiển thị');
                            break;
                        case 'hidden':
                            showRow = status.includes('đã ẩn');
                            break;
                        case 'pending':
                            showRow = status.includes('chờ') || status.includes('pending');
                            break;
                    }
                    
                    if (showRow) {
                        $row.show();
                    } else {
                        $row.hide();
                    }
                });

                // Also filter mobile grid view
                $('.lesson-card').each(function() {
                    const $card = $(this);
                    const status = $card.find('.status-badge').text().trim().toLowerCase();
                    
                    let showCard = false;
                    
                    switch(filter) {
                        case 'all':
                            showCard = true;
                            break;
                        case 'active':
                            showCard = status.includes('đang hiển thị');
                            break;
                        case 'hidden':
                            showCard = status.includes('đã ẩn');
                            break;
                        case 'pending':
                            showCard = status.includes('chờ') || status.includes('pending');
                            break;
                    }
                    
                    if (showCard) {
                        $card.show();
                    } else {
                        $card.hide();
                    }
                });
            });

            // Handle course filter
            $('.course-filter').on('change', function() {
                const courseId = $(this).val();
                
                if (!courseId) {
                    // Show all lessons
                    $('tbody tr').show();
                    $('.lesson-card').show();
                    return;
                }
                
                // Filter by course
                $('tbody tr').each(function() {
                    const $row = $(this);
                    const rowCourseCode = $row.find('td:nth-child(3) small.text-muted').text().trim();
                    
                    if (rowCourseCode === courseId) {
                        $row.show();
                    } else {
                        $row.hide();
                    }
                });

                // Also filter mobile grid view
                $('.lesson-card').each(function() {
                    const $card = $(this);
                    const cardCourseName = $card.find('.lesson-card-info small.text-muted').text().trim();
                    
                    // Simple check - in real app would need course ID
                    if (cardCourseName.includes(courseId) || !courseId) {
                        $card.show();
                    } else {
                        $card.hide();
                    }
                });
            });

            // Handle view toggle (list/grid) - only on mobile
            $('[data-view]').on('click', function(e) {
                e.preventDefault();
                
                // Only toggle on mobile screens
                if (window.innerWidth > 768) {
                    toastr.info('Chế độ xem grid chỉ khả dụng trên thiết bị di động');
                    return;
                }
                
                const view = $(this).data('view');
                
                // Update active button
                $('[data-view]').removeClass('active');
                $(this).addClass('active');
                
                if (view === 'list') {
                    // Show table view, hide grid view
                    $('.admin-lessons-table').show();
                    $('.mobile-lessons-grid').hide();
                } else {
                    // Show grid view, hide table view
                    $('.admin-lessons-table').hide();
                    $('.mobile-lessons-grid').show();
                }
            });

            // Handle window resize to update view
            $(window).on('resize', function() {
                if (window.innerWidth > 768) {
                    // On desktop, always show table view
                    $('.admin-lessons-table').show();
                    $('.mobile-lessons-grid').hide();
                    $('[data-view="list"]').addClass('active');
                    $('[data-view="grid"]').removeClass('active');
                }
            });

            // Handle select all checkbox
            $('.select-all-lessons').on('change', function() {
                const isChecked = $(this).prop('checked');
                $('.lesson-checkbox').prop('checked', isChecked);
                updateBulkSelectionCount();
            });

            // Handle individual checkbox changes
            $('.lesson-checkbox').on('change', function() {
                updateBulkSelectionCount();
                
                // Update select all checkbox state
                const totalCheckboxes = $('.lesson-checkbox').length;
                const checkedCheckboxes = $('.lesson-checkbox:checked').length;
                $('.select-all-lessons').prop('checked', totalCheckboxes === checkedCheckboxes);
            });

            // Update bulk selection count
            function updateBulkSelectionCount() {
                const selectedCount = $('.lesson-checkbox:checked').length;
                $('.bulk-selection-count').text(`${selectedCount} bài học được chọn`);
                
                // Enable/disable bulk action buttons
                if (selectedCount > 0) {
                    $('.bulk-activate, .bulk-hide, .bulk-delete, .bulk-export').prop('disabled', false);
                } else {
                    $('.bulk-activate, .bulk-hide, .bulk-delete, .bulk-export').prop('disabled', true);
                }
            }

            // Handle bulk actions
            $('.bulk-activate').on('click', function() {
                const selectedIds = getSelectedLessonIds();
                if (selectedIds.length === 0) return;
                
                Swal.fire({
                    title: 'Hiển thị hàng loạt',
                    html: `Bạn có chắc chắn muốn hiển thị <strong>${selectedIds.length} bài học</strong>?`,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Hiển thị',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Implement bulk activation logic here
                        toastr.success(`Đã hiển thị ${selectedIds.length} bài học`);
                    }
                });
            });

            $('.bulk-hide').on('click', function() {
                const selectedIds = getSelectedLessonIds();
                if (selectedIds.length === 0) return;
                
                Swal.fire({
                    title: 'Ẩn hàng loạt',
                    html: `Bạn có chắc chắn muốn ẩn <strong>${selectedIds.length} bài học</strong>?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ẩn',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Implement bulk hide logic here
                        toastr.success(`Đã ẩn ${selectedIds.length} bài học`);
                    }
                });
            });

            $('.bulk-delete').on('click', function() {
                const selectedIds = getSelectedLessonIds();
                if (selectedIds.length === 0) return;
                
                Swal.fire({
                    title: 'Xóa hàng loạt',
                    html: `Bạn có chắc chắn muốn xóa <strong>${selectedIds.length} bài học</strong>?<br><br>
                           <small class="text-muted">Hành động này không thể hoàn tác.</small>`,
                    icon: 'error',
                    showCancelButton: true,
                    confirmButtonText: 'Xóa',
                    cancelButtonText: 'Hủy',
                    confirmButtonColor: '#d33'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Implement bulk delete logic here
                        toastr.success(`Đã xóa ${selectedIds.length} bài học`);
                    }
                });
            });

            $('.bulk-export').on('click', function() {
                const selectedIds = getSelectedLessonIds();
                if (selectedIds.length === 0) return;
                
                toastr.info(`Đang xuất ${selectedIds.length} bài học sang CSV...`);
                // Implement export logic here
            });

            // Get selected lesson IDs
            function getSelectedLessonIds() {
                const selectedIds = [];
                $('.lesson-checkbox:checked').each(function() {
                    selectedIds.push($(this).val());
                });
                return selectedIds;
            }

            // Initialize bulk actions state
            updateBulkSelectionCount();
        });
    </script>
}
